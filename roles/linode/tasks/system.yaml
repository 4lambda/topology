---
- name: Ensure hosts are up.
  local_action:
     module: linode
     api_key: "{{ api_key }}"
     name: "{{ inventory_hostname_short }}"
     plan: "{{ plan }}"
     linode_id: "{{ lid }}"
     datacenter: "{{ datacenter }}"
     distribution: "{{ distribution }}"
     password: "{{ password }}"
     ssh_pub_key: "{{ ssh.public }}"
     swap: "{{ swap }}"
     wait: yes
     state: present

- name: Hosts have hostnames.
  hostname:
    name: "{{ inventory_hostname_short }}"

- name: Chicago Timezone.
  timezone:
    name: America/Chicago

- name: Setup ifcfg.
  template:
    src: ifcfg-ethx
    dest: /etc/sysconfig/network-scripts/ifcfg-eth0
  notify: NETWORK

- name: Disable password authentication.
  lineinfile:
    dest: /etc/ssh/sshd_config
    state: present
    regexp: '^PasswordAuthentication'
    line: 'PasswordAuthentication no'
  notify: SSHD

- name: EPEL is provided.
  yum:
    name: epel-release
    state: present

- name: Ensure wanted packages are installed.
  yum:
    name: "{{ item }}"
    state: present
    update_cache: yes
  with_items:
    - python-pip
    - iptables-services

- name: Disable firewalld
  systemd:
    name: firewalld
    state: stopped
    enabled: no

- name: Copy firewall rules.
  copy:
    src: "{{ item }}"
    dest: /etc/sysconfig/
  with_items:
    - iptables
    - ip6tables
  notify: IP
