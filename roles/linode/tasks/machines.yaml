---
- name: Ensure hosts are up.
  local_action:
     module: linode
     api_key: "{{ api_key }}"
     name: "{{ inventory_hostname_short }}"
     plan: "{{ plan }}"
     linode_id: "{{ lid }}"
     datacenter: "{{ datacenter }}"
     distribution: "{{ distribution }}"
     password: "{{ password }}"
     ssh_pub_key: "{{ ssh.public }}"
     swap: "{{ swap }}"
     wait: yes
     state: present
  when: inventory_hostname not in groups['loads']

- name: Set hosts' hostnames.
  hostname:
    name: "{{ inventory_hostname_short }}"